@model Participant
@{
    Layout = "~/Views/Shared/AdminLTE/_Layout.cshtml";

    var indexs = (Dictionary<Section, List<List<Question>>>)ViewData["Indexs"];
    var id = (int)ViewData["Id"];
    var mode = (int)ViewData["Mode"];
    var question = (Question)ViewData["Question"];
    var questionNext = (Question)ViewData["QuestionNext"];
    var questionPrevious = (Question)ViewData["QuestionPrevious"];
    var part = (Section)ViewData["Section"];

    var questionAnswer = (List<QuestionAnswer>)ViewData["QuestionAnswer"];
    var questionAnswerMatrix = (List<QuestionAnswer>)ViewData["QuestionAnswerMatrix"];
}

<div class="row">
    <div class="col-md-12">
        @if (mode == 1 && part != null)
        {
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Panduan Pengisian</h3>
                    <div class="card-tools">
                    </div>
                </div>
                <div class="card-body">
                    @Html.Raw(part.Introduction)
                </div>
            </div>
        }
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Indek Survei</h3>
                <div class="card-tools">
                </div>
            </div>
            <div class="card-body">
                <div class="">
                    <table>
                        @foreach (Section sect in indexs.Keys)
                        {
                            <tr>
                                <td><b><a href="~/survey-participant/detail/@Model.ID?mode=0&id=@sect.ID">Bagian @sect.Sequence</a></b></td>
                                <td>&nbsp;&nbsp;:&nbsp;&nbsp;</td>
                                <td>
                                    <ul class="pagination" style="margin-bottom:0px; flex-wrap:wrap">
                                        @foreach (List<Question> quess in indexs[sect])
                                        {
                                            @foreach (Question ques in quess)
                                            {
                                                <li class="paginate_button page-item ">
                                                    <a style="width:45px;padding:0.25rem;text-align:center" href="~/survey-participant/detail/@Model.ID?mode=1&id=@ques.ID" data-question="@ques.ID" tabindex="0" class="page-link">@ques.Sequence</a>
                                                </li>
                                            }
                                        }
                                    </ul>
                                </td>
                            </tr>
                        }
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="module form-modal">
            <div class="card">
                @if ((mode == 0 && part == null) || (mode == 1 && question == null))
                {
                    <div class="card-header">
                        <h3 class="card-title">
                            Data Tidak Ditemukan
                        </h3>
                    </div>
                    <div class="card-body">
                        <h2>Data Tidak Ditemukan</h2>
                    </div>
                }
                else
                {
                    <div class="card-header">
                        <h3 class="card-title">
                            @if (mode == 0)
                            {
                                <span>Bagian @part.Sequence</span>
                            }
                            else
                            {
                                <span>Situasi @question.Sequence</span>;
                            }
                        </h3>
                        <div class="card-tools">
                        </div>
                    </div>
                    <!-- /.card-header -->
                    <div class="card-body">
                        @if (mode == 0)
                        {
                            @Html.Raw(part.Introduction)

                            <br />
                            <a href="~/survey-participant/detail/@Model.ID?mode=1&id=@question.ID" class="btn btn-primary">Mulai Mengerjakan&nbsp;<i class="fa fa-step-forward"></i></a>
                        }
                        else
                        {
                            <img style="width:100%" src="https://app.lp3t.abdil.my.id/uploads/@question.Attachment" />
                            <br />
                            @Html.Raw(question.Description)
                        }
                        <br />
                    </div>
                    <!-- /.card-body -->
                }
            </div>
        </div>
    </div>
    @if (mode == 1)
    {
        <div class="col-md-6">
            <div class="module form-modal">
                <div class="card">
                    @if ((mode == 0 && part == null) || (mode == 1 && question == null))
                    {
                        <div class="card-header">
                            <h3 class="card-title">
                                Data Tidak Ditemukan
                            </h3>
                        </div>
                        <div class="card-body">
                            <h2>Data Tidak Ditemukan</h2>
                        </div>
                    }
                    else
                    {
                        <div class="card-header">
                            <h3 class="card-title">
                                <span>Respon Situasi @question.Sequence</span>
                            </h3>
                            <div class="card-tools">
                            </div>
                        </div>
                        <!-- /.card-header -->
                        <div class="card-body">
                            <table cellpadding="2" cellspacing="2" style="width:100%" class="table">
                                <thead>
                                    <tr>
                                        <th style="width:40px">No</th>
                                        <th>Pernyataan</th>
                                        @foreach (QuestionAnswer qa in questionAnswer.OrderBy(x => x.Sequence))
                                        {
                                            @if (question.QuestionType == QuestionType.MATRIX && question.MatrixSubType == MatrixSubType.CUSTOM)
                                            {
                                                <th style="width:85px;text-align:center">@qa.Value</th>
                                            }
                                            else if (question.QuestionType == QuestionType.MATRIX && question.MatrixSubType == MatrixSubType.SIMPLE)
                                            {
                                                <th style="width:225px;text-align:center">Respon</th>
                                                break;
                                            }
                                        }
                                    </tr>
                                </thead>
                                @{ var no = 1; }
                                @foreach (QuestionAnswer qa in questionAnswerMatrix.OrderBy(x => x.Sequence))
                                {
                                    <tbody>
                                        <tr>
                                            <td>@no</td>
                                            <td>@qa.Value</td>
                                            @if(question.QuestionType == QuestionType.MATRIX && question.MatrixSubType == MatrixSubType.CUSTOM) 
                                            { 
                                                foreach (QuestionAnswer qa1 in questionAnswer.OrderBy(x => x.Sequence))
                                                {
                                                    <td>
                                                        @if (qa1.MatrixValue == MatrixValueType.NUMERICAL_BOX)
                                                        {
                                                            <input style="text-align:center" value="0" type="number" class="form-control" />
                                                        }
                                                        else if (qa.MatrixValue == MatrixValueType.SEQUENCE)
                                                        {
                                                            <select class="form-control">
                                                                <option value=""></option>
                                                                <option value="1">1</option>
                                                                <option value="2">2</option>
                                                                <option value="3">3</option>
                                                                <option value="4">4</option>
                                                                <option value="5">5</option>
                                                            </select>
                                                        }
                                                    </td>
                                                }
                                            }
                                            else if(question.QuestionType == QuestionType.MATRIX && question.MatrixSubType == MatrixSubType.SIMPLE)
                                            {
                                                <td>
                                                    <select class="form-control">
                                                        <option value=""></option>
                                                        @foreach (QuestionAnswer qa1 in questionAnswer.OrderBy(x => x.Sequence))
                                                        {
                                                            <option value="@qa1.Value">@qa1.Value</option>
                                                        }
                                                    </select>
                                                </td>
                                            }
                                        </tr>
                                    </tbody>
                                    no++;
                                }
                                @if (question.QuestionType == QuestionType.MATRIX && question.MatrixSubType == MatrixSubType.CUSTOM)
                                {
                                    <tfoot>
                                        <tr>
                                            <th colspan="3">Total</th>
                                            <th style="text-align:center" align="center">0</th>
                                        </tr>
                                    </tfoot>
                                }
                            </table>
                            <br />
                            <button class="btn btn-danger pull-right"><i class="fa fa-save"></i>&nbsp;&nbsp;Simpan Respon</button>
                        </div>
                        <!-- /.card-body -->

                    }
                </div>
            </div>
        </div>
    }

    <div class="col-md-12">
        <div class="modal-footer" style="justify-content:center">
            @if (questionPrevious != null && mode == 1)
            {
                if (questionPrevious.Section.ID == question.Section.ID)
                {
                    <a href="~/survey-participant/detail/@Model.ID?mode=1&id=@questionPrevious.ID" id="close_form" class="btn btn-default"><i class="fa fa-step-backward"></i>&nbsp;Pertanyaan Sebelumnya</a>
                }
                else
                {
                    <a href="~/survey-participant/detail/@Model.ID?mode=0&id=@questionPrevious.Section.ID" id="close_form" class="btn btn-default"><i class="fa fa-step-backward"></i>&nbsp;Pertanyaan Sebelumnya</a>
                }
            }
            @if (questionNext != null && mode == 1)
            {
                if (questionNext.Section.ID == question.Section.ID)
                {
                    <a href="~/survey-participant/detail/@Model.ID?mode=1&id=@questionNext.ID" style="color:white" class="btn btn-primary">Pertanyaan Selanjutnya&nbsp;<i class="fa fa-step-forward"></i></a>
                }
                else
                {
                    <a href="~/survey-participant/detail/@Model.ID?mode=0&id=@questionNext.Section.ID" style="color:white" class="btn btn-primary">Pertanyaan Selanjutnya&nbsp;<i class="fa fa-step-forward"></i></a>
                }
            }
        </div>
    </div>

</div>